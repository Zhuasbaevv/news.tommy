
<div class="news-card">
    <button class="del-btn" onclick="this.parentElement.remove(); saveChanges();">Удалить</button>
    <img src="Без моего.jpg">
    <div class="news-content">
        <p>Первый пост сайта</p>
    </div>
</div>
        

<script>
    let GITHUB_TOKEN = "";
    const REPO = "Zhuasbaevv/news.tommy"; // Проверь имя!

    function showLogin() {
        const pass = prompt("Введите ваш GitHub Token для доступа к кнопкам:");
        if (pass) {
            GITHUB_TOKEN = pass;
            document.getElementById('admin-panel').style.display = 'block';
            document.querySelectorAll('.del-btn').forEach(b => b.style.display = 'block');
            alert("Режим админа включен!");
        }
    }

    async function publishNews() {
        const img = document.getElementById('img-url').value;
        const text = document.getElementById('news-text').value;
        if (!text) return alert("Введите текст!");

        const newPost = `
<div class="news-card">
    <button class="del-btn" onclick="this.parentElement.remove(); saveChanges();">Удалить</button>
    ${img ? `<img src="${img}">` : ''}
    <div class="news-content">
        <p>${text.replace(/\n/g, '<br>')}</p>
    </div>
</div>`;

        const container = document.getElementById('news-container');
        container.insertAdjacentHTML('afterbegin', newPost);
        await saveChanges();
    }

    async function saveChanges() {
        if (!GITHUB_TOKEN) return alert("Ошибка: Нет токена!");

        try {
            // 1. Получаем текущий файл
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/index.html`);
            const data = await res.json();
            let content = decodeURIComponent(escape(atob(data.content)));

            // 2. Обновляем блок новостей
            const containerHtml = document.getElementById('news-container').innerHTML;
            const startTag = "";
            const newContent = content.replace(
                new RegExp(`${startTag}[\\s\\S]*?</div>\\s*</div>`, 'm'), 
                `${startTag}${containerHtml}`
            );

            // 3. Отправляем обратно на GitHub
            const updateRes = await fetch(`https://api.github.com/repos/${REPO}/contents/index.html`, {
                method: "PUT",
                headers: { "Authorization": `token ${GITHUB_TOKEN}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: "Обновление новостей через админку",
                    content: btoa(unescape(encodeURIComponent(newContent))),
                    sha: data.sha
                })
            });

            if (updateRes.ok) alert("Успешно сохранено на сервере!");
            else alert("Ошибка сохранения. Проверьте токен.");
        } catch (e) {
            console.error(e);
            alert("Произошла ошибка при связи с GitHub");
        }
    }
</script>

</body>
</html>
