<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–æ—Å—Ç–∏ –¢–æ–º–º–∏</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --main: #1a1a1a; --accent: #ff4757; --bg: #0f0f0f; }
        body { font-family: 'Arial', sans-serif; background: var(--bg); color: #eee; margin: 0; padding-bottom: 50px; }
        header { background: #1a1a1a; padding: 25px; text-align: center; border-bottom: 4px solid var(--accent); cursor: pointer; user-select: none; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        
        /* –ê–¥–º–∏–Ω–∫–∞ */
        #admin-panel { background: #222; padding: 20px; border-radius: 12px; display: none; margin-bottom: 30px; border: 1px solid #333; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #333; color: #fff; border: 1px solid #444; border-radius: 6px; box-sizing: border-box; }
        
        .file-upload { display: block; background: #444; padding: 15px; text-align: center; border-radius: 6px; cursor: pointer; margin: 10px 0; border: 2px dashed #666; }
        .file-upload:hover { background: #555; }
        #preview { width: 100%; max-height: 200px; object-fit: contain; margin-top: 10px; display: none; border-radius: 6px; }
        
        .btn-pub { background: var(--accent); color: white; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 6px; font-size: 18px; }
        .btn-pub:disabled { opacity: 0.5; cursor: not-allowed; }

        /* –ü–æ—Å—Ç—ã */
        .post { background: #1a1a1a; margin-bottom: 25px; border-radius: 15px; overflow: hidden; border: 1px solid #222; position: relative; }
        .post img { width: 100%; max-height: 500px; object-fit: cover; display: block; }
        .post-content { padding: 20px; }
        .post h2 { margin: 0 0 10px 0; color: var(--accent); }
        .del-btn { position: absolute; top: 10px; right: 10px; background: red; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; display: none; }
        .admin-mode .del-btn { display: block; }
        .hidden { display: none; }
    </style>
</head>
<body id="body">

<header onclick="openAdmin()">
    <h1>–ù–û–í–û–°–¢–ò –¢–û–ú–ú–ò</h1>
</header>

<div class="container">
    <div id="admin-panel">
        <input type="text" id="t" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
        <textarea id="c" rows="4" placeholder="–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏"></textarea>
        
        <label class="file-upload">
            üì∏ –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            <input type="file" id="f" accept="image/*" class="hidden" onchange="previewImage(this)">
            <img id="preview">
        </label>
        
        <button id="pubBtn" class="btn-pub" onclick="send()">–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨</button>
        <p id="loader" style="display:none; text-align:center;">–ó–∞–≥—Ä—É–∑–∫–∞... –ñ–¥–∏...</p>
    </div>

    <div id="feed">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD6NVFOGnCVVgzh-ijtAK_bUWmewRqm8vY",
        authDomain: "tommynews-a46bb.firebaseapp.com",
        projectId: "tommynews-a46bb",
        storageBucket: "tommynews-a46bb.appspot.com",
        messagingSenderId: "263117878730",
        appId: "1:263117878730:web:9f88d07d8305d9169bcb33"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let base64Image = "";

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
    function previewImage(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                base64Image = e.target.result;
                const img = document.getElementById('preview');
                img.src = base64Image;
                img.style.display = "block";
            }
            reader.readAsDataURL(file);
        }
    }

    // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –≤—Ö–æ–¥
    let clicks = 0;
    function openAdmin() {
        clicks++;
        if(clicks >= 5) {
            if(prompt("–ü–∞—Ä–æ–ª—å –¢–æ–º–º–∏:") === "777") {
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('body').classList.add('admin-mode');
            }
            clicks = 0;
        }
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–∞–∑—É
    async function send() {
        const title = document.getElementById('t').value;
        const text = document.getElementById('c').value;
        const btn = document.getElementById('pubBtn');
        const loader = document.getElementById('loader');

        if(!title || !text) return alert("–ù–∞–ø–∏—à–∏ —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ!");

        btn.disabled = true;
        loader.style.display = "block";

        try {
            await db.collection("posts").add({
                title,
                text,
                image: base64Image, // –¢—É—Ç —Å–∞–º–∞ —Ñ–æ—Ç–∫–∞ –≤ –∫–æ–¥–µ
                date: firebase.firestore.FieldValue.serverTimestamp()
            });

            document.getElementById('t').value = "";
            document.getElementById('c').value = "";
            document.getElementById('f').value = "";
            document.getElementById('preview').style.display = "none";
            base64Image = "";
            alert("–ì–æ—Ç–æ–≤–æ! –ù–æ–≤–æ—Å—Ç—å –Ω–∞ —Å–∞–π—Ç–µ.");
        } catch(e) {
            alert("–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å Rules –≤ Firestore Database.");
        }

        btn.disabled = false;
        loader.style.display = "none";
    }

    // –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
    db.collection("posts").orderBy("date", "desc").onSnapshot(s => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        s.forEach(doc => {
            const d = doc.data();
            feed.innerHTML += `
                <div class="post">
                    <button class="del-btn" onclick="del('${doc.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    ${d.image ? `<img src="${d.image}">` : ''}
                    <div class="post-content">
                        <h2>${d.title}</h2>
                        <p>${d.text}</p>
                    </div>
                </div>`;
        });
    });

    async function del(id) {
        if(confirm("–£–¥–∞–ª–∏—Ç—å?")) await db.collection("posts").doc(id).delete();
    }
</script>
</body>
</html>
